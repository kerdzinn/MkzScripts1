-- ESP Script para Phantom Forces - Vers√£o Xeno Compat√≠vel
-- Execute no Xeno Executor

print("üîÑ Iniciando ESP...")

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera

-- Tentar obter PlayerGui
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui", 5)
if not PlayerGui then
    warn("‚ùå PlayerGui n√£o encontrado!")
    return
end

print("‚úÖ PlayerGui encontrado")

-- Configura√ß√µes
local Settings = {
    Enabled = true,
    TeamCheck = true,
    MaxDistance = 2000,
    ShowBox = true,
    ShowName = true,
    ShowDistance = true,
}

local ESPObjects = {}

-- Criar ScreenGui principal
local MainGui = Instance.new("ScreenGui")
MainGui.Name = "PFesp_" .. tostring(math.random(1000, 9999))
MainGui.ResetOnSpawn = false
MainGui.IgnoreGuiInset = true
MainGui.Parent = PlayerGui

print("‚úÖ ScreenGui criado")

-- Fun√ß√£o para criar ESP de um jogador
local function CreateESP(Player)
    if Player == LocalPlayer then return end
    if ESPObjects[Player] then return end
    
    print("üìå Criando ESP para: " .. Player.Name)
    
    local ESPHolder = Instance.new("Folder")
    ESPHolder.Name = "ESP_" .. Player.Name
    ESPHolder.Parent = MainGui
    
    -- Criar box (4 linhas)
    local Box = {}
    for i = 1, 4 do
        local Line = Instance.new("Frame")
        Line.Name = "Line" .. i
        Line.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
        Line.BorderSizePixel = 0
        Line.Visible = false
        Line.ZIndex = 2
        Line.Parent = ESPHolder
        Box[i] = Line
    end
    
    -- Criar texto do nome
    local NameLabel = Instance.new("TextLabel")
    NameLabel.Name = "Name"
    NameLabel.BackgroundTransparency = 1
    NameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    NameLabel.TextStrokeTransparency = 0.5
    NameLabel.TextSize = 14
    NameLabel.Font = Enum.Font.Code
    NameLabel.Text = Player.Name
    NameLabel.Visible = false
    NameLabel.ZIndex = 3
    NameLabel.Size = UDim2.new(0, 200, 0, 20)
    NameLabel.Parent = ESPHolder
    
    -- Criar texto da dist√¢ncia
    local DistLabel = Instance.new("TextLabel")
    DistLabel.Name = "Distance"
    DistLabel.BackgroundTransparency = 1
    DistLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    DistLabel.TextStrokeTransparency = 0.5
    DistLabel.TextSize = 12
    DistLabel.Font = Enum.Font.Code
    DistLabel.Text = "0m"
    DistLabel.Visible = false
    DistLabel.ZIndex = 3
    DistLabel.Size = UDim2.new(0, 200, 0, 20)
    DistLabel.Parent = ESPHolder
    
    ESPObjects[Player] = {
        Holder = ESPHolder,
        Box = Box,
        Name = NameLabel,
        Distance = DistLabel
    }
end

-- Fun√ß√£o para remover ESP
local function RemoveESP(Player)
    if ESPObjects[Player] then
        ESPObjects[Player].Holder:Destroy()
        ESPObjects[Player] = nil
        print("üóëÔ∏è ESP removido: " .. Player.Name)
    end
end

-- Fun√ß√£o para atualizar ESP
local function UpdateESP()
    if not Settings.Enabled then
        for _, esp in pairs(ESPObjects) do
            esp.Holder.Visible = false
        end
        return
    end
    
    for Player, ESP in pairs(ESPObjects) do
        pcall(function()
            if not Player or not Player.Parent then
                RemoveESP(Player)
                return
            end
            
            local Character = Player.Character
            if not Character then
                ESP.Holder.Visible = false
                return
            end
            
            local Humanoid = Character:FindFirstChildOfClass("Humanoid")
            local RootPart = Character:FindFirstChild("HumanoidRootPart")
            
            if not Humanoid or Humanoid.Health <= 0 or not RootPart then
                ESP.Holder.Visible = false
                return
            end
            
            -- Team check
            if Settings.TeamCheck then
                if Player.Team and LocalPlayer.Team and Player.Team == LocalPlayer.Team then
                    ESP.Holder.Visible = false
                    return
                end
            end
            
            -- Calcular dist√¢ncia
            local LocalChar = LocalPlayer.Character
            local LocalRoot = LocalChar and LocalChar:FindFirstChild("HumanoidRootPart")
            
            if not LocalRoot then
                ESP.Holder.Visible = false
                return
            end
            
            local Distance = (LocalRoot.Position - RootPart.Position).Magnitude
            
            if Distance > Settings.MaxDistance then
                ESP.Holder.Visible = false
                return
            end
            
            -- Calcular posi√ß√µes
            local Head = Character:FindFirstChild("Head")
            if not Head then
                ESP.Holder.Visible = false
                return
            end
            
            local HeadPos = Head.Position + Vector3.new(0, 0.5, 0)
            local LegPos = RootPart.Position - Vector3.new(0, 3, 0)
            
            local TopPos, TopVis = Camera:WorldToViewportPoint(HeadPos)
            local BottomPos, BottomVis = Camera:WorldToViewportPoint(LegPos)
            
            if not TopVis and not BottomVis then
                ESP.Holder.Visible = false
                return
            end
            
            ESP.Holder.Visible = true
            
            -- Calcular tamanho da box
            local Height = math.abs(TopPos.Y - BottomPos.Y)
            local Width = Height * 0.5
            
            local X = TopPos.X
            local Y = math.min(TopPos.Y, BottomPos.Y)
            
            -- Atualizar box
            if Settings.ShowBox then
                -- Linha de cima
                ESP.Box[1].Size = UDim2.new(0, Width, 0, 2)
                ESP.Box[1].Position = UDim2.new(0, X - Width/2, 0, Y)
                ESP.Box[1].Visible = true
                
                -- Linha de baixo
                ESP.Box[2].Size = UDim2.new(0, Width, 0, 2)
                ESP.Box[2].Position = UDim2.new(0, X - Width/2, 0, Y + Height)
                ESP.Box[2].Visible = true
                
                -- Linha esquerda
                ESP.Box[3].Size = UDim2.new(0, 2, 0, Height)
                ESP.Box[3].Position = UDim2.new(0, X - Width/2, 0, Y)
                ESP.Box[3].Visible = true
                
                -- Linha direita
                ESP.Box[4].Size = UDim2.new(0, 2, 0, Height)
                ESP.Box[4].Position = UDim2.new(0, X + Width/2, 0, Y)
                ESP.Box[4].Visible = true
            else
                for i = 1, 4 do
                    ESP.Box[i].Visible = false
                end
            end
            
            -- Atualizar nome
            if Settings.ShowName then
                ESP.Name.Text = Player.Name
                ESP.Name.Position = UDim2.new(0, X - 100, 0, Y - 20)
                ESP.Name.Visible = true
            else
                ESP.Name.Visible = false
            end
            
            -- Atualizar dist√¢ncia
            if Settings.ShowDistance then
                ESP.Distance.Text = string.format("%.0fm", Distance)
                ESP.Distance.Position = UDim2.new(0, X - 100, 0, Y - 35)
                ESP.Distance.Visible = true
            else
                ESP.Distance.Visible = false
            end
        end)
    end
end

-- Conectar jogadores
for _, Player in ipairs(Players:GetPlayers()) do
    if Player ~= LocalPlayer then
        CreateESP(Player)
    end
end

Players.PlayerAdded:Connect(function(Player)
    task.wait(1)
    CreateESP(Player)
end)

Players.PlayerRemoving:Connect(RemoveESP)

-- Detectar quando character spawna
for _, Player in ipairs(Players:GetPlayers()) do
    if Player ~= LocalPlayer then
        Player.CharacterAdded:Connect(function()
            task.wait(1)
            CreateESP(Player)
        end)
    end
end

print("‚úÖ ESP de jogadores configurado")

-- Criar UI de controle
local ControlGui = Instance.new("ScreenGui")
ControlGui.Name = "ESPControl_" .. tostring(math.random(1000, 9999))
ControlGui.ResetOnSpawn = false
ControlGui.Parent = PlayerGui

local Menu = Instance.new("Frame")
Menu.Size = UDim2.new(0, 200, 0, 230)
Menu.Position = UDim2.new(0, 10, 0.5, -115)
Menu.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
Menu.BorderSizePixel = 2
Menu.BorderColor3 = Color3.fromRGB(255, 0, 0)
Menu.Active = true
Menu.Draggable = true
Menu.Parent = ControlGui

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 30)
Title.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
Title.BorderSizePixel = 0
Title.Text = "ESP MENU"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextSize = 16
Title.Font = Enum.Font.SourceSansBold
Title.Parent = Menu

-- Criar bot√µes
local function CreateButton(Text, Position, Callback)
    local Btn = Instance.new("TextButton")
    Btn.Size = UDim2.new(0.9, 0, 0, 30)
    Btn.Position = UDim2.new(0.05, 0, 0, Position)
    Btn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    Btn.BorderSizePixel = 1
    Btn.BorderColor3 = Color3.fromRGB(100, 100, 100)
    Btn.Text = Text
    Btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    Btn.TextSize = 14
    Btn.Font = Enum.Font.SourceSans
    Btn.Parent = Menu
    
    Btn.MouseButton1Click:Connect(Callback)
    
    return Btn
end

local ToggleESP = CreateButton("ESP: ON", 40, function()
    Settings.Enabled = not Settings.Enabled
    ToggleESP.Text = Settings.Enabled and "ESP: ON" or "ESP: OFF"
    ToggleESP.BackgroundColor3 = Settings.Enabled and Color3.fromRGB(0, 100, 0) or Color3.fromRGB(100, 0, 0)
end)
ToggleESP.BackgroundColor3 = Color3.fromRGB(0, 100, 0)

local ToggleTeam = CreateButton("Team Check: ON", 80, function()
    Settings.TeamCheck = not Settings.TeamCheck
    ToggleTeam.Text = Settings.TeamCheck and "Team Check: ON" or "Team Check: OFF"
end)

local ToggleBox = CreateButton("Box: ON", 120, function()
    Settings.ShowBox = not Settings.ShowBox
    ToggleBox.Text = Settings.ShowBox and "Box: ON" or "Box: OFF"
end)

local ToggleName = CreateButton("Name: ON", 160, function()
    Settings.ShowName = not Settings.ShowName
    ToggleName.Text = Settings.ShowName and "Name: ON" or "Name: OFF"
end)

local ToggleDist = CreateButton("Distance: 2000m", 200, function()
    local Distances = {500, 1000, 2000, 5000}
    local Index = table.find(Distances, Settings.MaxDistance) or 3
    Settings.MaxDistance = Distances[(Index % #Distances) + 1]
    ToggleDist.Text = "Distance: " .. Settings.MaxDistance .. "m"
end)

print("‚úÖ Menu de controle criado")

-- Loop principal
RunService.RenderStepped:Connect(UpdateESP)

print("üéâ ESP CARREGADO COM SUCESSO!")
print("üìç Menu criado no lado esquerdo")
print("üñ±Ô∏è Arraste o menu pela barra de t√≠tulo")

-- Notifica√ß√£o visual
local Notif = Instance.new("ScreenGui")
Notif.Parent = PlayerGui

local NotifFrame = Instance.new("Frame")
NotifFrame.Size = UDim2.new(0, 300, 0, 60)
NotifFrame.Position = UDim2.new(0.5, -150, 0, 20)
NotifFrame.BackgroundColor3 = Color3.fromRGB(0, 150, 0)
NotifFrame.BorderSizePixel = 0
NotifFrame.Parent = Notif

local NotifText = Instance.new("TextLabel")
NotifText.Size = UDim2.new(1, 0, 1, 0)
NotifText.BackgroundTransparency = 1
NotifText.Text = "‚úÖ ESP CARREGADO!\nMenu no lado esquerdo"
NotifText.TextColor3 = Color3.fromRGB(255, 255, 255)
NotifText.TextSize = 18
NotifText.Font = Enum.Font.SourceSansBold
NotifText.Parent = NotifFrame

task.wait(3)
Notif:Destroy()
