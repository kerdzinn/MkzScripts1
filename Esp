-- ESP Simplificado para Phantom Forces
-- Execute no console do Executor

if not game:IsLoaded() then
    game.Loaded:Wait()
end

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

local localPlayer = Players.LocalPlayer
local espCache = {}

-- Configurações básicas
local settings = {
    enabled = true,
    teamCheck = true,
    maxDistance = 500,
    
    enemyColor = Color3.fromRGB(255, 0, 0),
    teamColor = Color3.fromRGB(0, 255, 0)
}

-- Função simples para criar ESP
local function createSimpleESP(player)
    if espCache[player] then return end
    
    local drawing = {
        box = {},
        name = nil,
        distance = nil
    }
    
    -- Usar Drawing.new para criar elementos visuais
    for i = 1, 4 do
        drawing.box[i] = Drawing.new("Line")
        drawing.box[i].Visible = false
        drawing.box[i].Thickness = 1
        drawing.box[i].ZIndex = 1
    end
    
    drawing.name = Drawing.new("Text")
    drawing.name.Visible = false
    drawing.name.Size = 14
    drawing.name.Center = true
    drawing.name.Outline = true
    drawing.name.ZIndex = 1
    
    drawing.distance = Drawing.new("Text")
    drawing.distance.Visible = false
    drawing.distance.Size = 12
    drawing.distance.Center = true
    drawing.distance.Outline = true
    drawing.distance.ZIndex = 1
    
    espCache[player] = drawing
end

-- Função para atualizar ESP
local function updateSimpleESP()
    if not settings.enabled then
        for _, drawing in pairs(espCache) do
            for i = 1, 4 do
                drawing.box[i].Visible = false
            end
            drawing.name.Visible = false
            drawing.distance.Visible = false
        end
        return
    end
    
    local camera = Workspace.CurrentCamera
    if not camera then return end
    
    for player, drawing in pairs(espCache) do
        local character = player.Character
        if character and character:FindFirstChild("HumanoidRootPart") and character.Humanoid.Health > 0 then
            local rootPart = character.HumanoidRootPart
            local screenPoint, onScreen = camera:WorldToViewportPoint(rootPart.Position)
            
            if onScreen then
                local isEnemy = not settings.teamCheck or (localPlayer.Team and player.Team and localPlayer.Team ~= player.Team)
                local color = isEnemy and settings.enemyColor or settings.teamColor
                
                local distance = (camera.CFrame.Position - rootPart.Position).Magnitude
                if distance <= settings.maxDistance then
                    -- Calcular posições da box
                    local scale = 100 / distance
                    local size = Vector2.new(4 * scale, 6 * scale) * 10
                    
                    local topLeft = Vector2.new(screenPoint.X - size.X/2, screenPoint.Y - size.Y/2)
                    local topRight = Vector2.new(screenPoint.X + size.X/2, screenPoint.Y - size.Y/2)
                    local bottomLeft = Vector2.new(screenPoint.X - size.X/2, screenPoint.Y + size.Y/2)
                    local bottomRight = Vector2.new(screenPoint.X + size.X/2, screenPoint.Y + size.Y/2)
                    
                    -- Desenhar box
                    drawing.box[1].From = topLeft
                    drawing.box[1].To = topRight
                    drawing.box[1].Color = color
                    drawing.box[1].Visible = true
                    
                    drawing.box[2].From = topRight
                    drawing.box[2].To = bottomRight
                    drawing.box[2].Color = color
                    drawing.box[2].Visible = true
                    
                    drawing.box[3].From = bottomRight
                    drawing.box[3].To = bottomLeft
                    drawing.box[3].Color = color
                    drawing.box[3].Visible = true
                    
                    drawing.box[4].From = bottomLeft
                    drawing.box[4].To = topLeft
                    drawing.box[4].Color = color
                    drawing.box[4].Visible = true
                    
                    -- Texto do nome
                    drawing.name.Text = player.Name
                    drawing.name.Position = Vector2.new(screenPoint.X, screenPoint.Y - size.Y/2 - 20)
                    drawing.name.Color = color
                    drawing.name.Visible = true
                    
                    -- Texto da distância
                    drawing.distance.Text = math.floor(distance) .. " studs"
                    drawing.distance.Position = Vector2.new(screenPoint.X, screenPoint.Y - size.Y/2 - 35)
                    drawing.distance.Color = color
                    drawing.distance.Visible = true
                else
                    for i = 1, 4 do drawing.box[i].Visible = false end
                    drawing.name.Visible = false
                    drawing.distance.Visible = false
                end
            else
                for i = 1, 4 do drawing.box[i].Visible = false end
                drawing.name.Visible = false
                drawing.distance.Visible = false
            end
        else
            for i = 1, 4 do drawing.box[i].Visible = false end
            drawing.name.Visible = false
            drawing.distance.Visible = false
        end
    end
end

-- Gerenciar jogadores
local function setupPlayer(player)
    if player == localPlayer then return end
    
    player.CharacterAdded:Connect(function()
        wait(0.5)
        createSimpleESP(player)
    end)
    
    if player.Character then
        createSimpleESP(player)
    end
end

-- Inicializar
for _, player in ipairs(Players:GetPlayers()) do
    setupPlayer(player)
end

Players.PlayerAdded:Connect(setupPlayer)
Players.PlayerRemoving:Connect(function(player)
    if espCache[player] then
        for _, drawing in pairs(espCache[player]) do
            if type(drawing) == "table" then
                for _, line in ipairs(drawing) do
                    line:Remove()
                end
            else
                drawing:Remove()
            end
        end
        espCache[player] = nil
    end
end)

-- Loop principal
RunService.RenderStepped:Connect(updateSimpleESP)

print("Simple ESP carregado!")
