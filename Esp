-- Universal ESP Box Script for Roblox (UI Version)
-- Coloque em um LocalScript no StarterPlayerScripts

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")

local localPlayer = Players.LocalPlayer
local espObjects = {}

-- Configurações
local ESP_SETTINGS = {
    ENABLED = true,
    SHOW_BOX = true,
    SHOW_NAME = true,
    SHOW_DISTANCE = true,
    TEAM_CHECK = true,
    MAX_DISTANCE = 1000,
    
    BOX_COLOR_ENEMY = Color3.fromRGB(255, 0, 0),
    BOX_COLOR_TEAM = Color3.fromRGB(0, 255, 0),
    BOX_COLOR_NEUTRAL = Color3.fromRGB(255, 255, 0),
    
    TEXT_COLOR = Color3.fromRGB(255, 255, 255),
    TEXT_SIZE = 14,
    TEXT_FONT = Enum.Font.GothamBold,
    
    BOX_THICKNESS = 2,
    BOX_TRANSPARENCY = 0.7
}

-- Função para verificar se o player é inimigo
local function isEnemy(player)
    if not ESP_SETTINGS.TEAM_CHECK then return true end
    if not localPlayer.Team then return true end
    if not player.Team then return true end
    return localPlayer.Team ~= player.Team
end

-- Função para calcular distância
local function getDistance(position)
    local character = localPlayer.Character
    if not character or not character:FindFirstChild("HumanoidRootPart") then
        return 0
    end
    return math.floor((character.HumanoidRootPart.Position - position).Magnitude)
end

-- Função para criar ESP para um player
local function createESP(player)
    if espObjects[player] then return end
    
    espObjects[player] = {
        boxGui = nil,
        nameLabel = nil,
        distanceLabel = nil
    }
    
    -- Aguardar character carregar
    repeat wait() until player.Character and player.Character:FindFirstChild("HumanoidRootPart")
    
    local character = player.Character
    local humanoidRootPart = character:WaitForChild("HumanoidRootPart")
    
    -- Criar Box UI
    if ESP_SETTINGS.SHOW_BOX then
        local boxGui = Instance.new("BillboardGui")
        boxGui.Name = "ESPBoxUI"
        boxGui.Adornee = humanoidRootPart
        boxGui.AlwaysOnTop = true
        boxGui.Size = UDim2.new(4, 0, 6, 0) -- Largura e altura em studs
        boxGui.StudsOffset = Vector3.new(0, 1, 0)
        boxGui.Active = false
        boxGui.ClipsDescendants = false
        
        -- Linha superior
        local topLine = Instance.new("Frame")
        topLine.Name = "TopLine"
        topLine.Size = UDim2.new(1, 0, 0, ESP_SETTINGS.BOX_THICKNESS)
        topLine.Position = UDim2.new(0, 0, 0, 0)
        topLine.BackgroundColor3 = ESP_SETTINGS.BOX_COLOR_ENEMY
        topLine.BorderSizePixel = 0
        topLine.BackgroundTransparency = ESP_SETTINGS.BOX_TRANSPARENCY
        topLine.Parent = boxGui
        
        -- Linha inferior
        local bottomLine = Instance.new("Frame")
        bottomLine.Name = "BottomLine"
        bottomLine.Size = UDim2.new(1, 0, 0, ESP_SETTINGS.BOX_THICKNESS)
        bottomLine.Position = UDim2.new(0, 0, 1, -ESP_SETTINGS.BOX_THICKNESS)
        bottomLine.BackgroundColor3 = ESP_SETTINGS.BOX_COLOR_ENEMY
        bottomLine.BorderSizePixel = 0
        bottomLine.BackgroundTransparency = ESP_SETTINGS.BOX_TRANSPARENCY
        bottomLine.Parent = boxGui
        
        -- Linha esquerda
        local leftLine = Instance.new("Frame")
        leftLine.Name = "LeftLine"
        leftLine.Size = UDim2.new(0, ESP_SETTINGS.BOX_THICKNESS, 1, 0)
        leftLine.Position = UDim2.new(0, 0, 0, 0)
        leftLine.BackgroundColor3 = ESP_SETTINGS.BOX_COLOR_ENEMY
        leftLine.BorderSizePixel = 0
        leftLine.BackgroundTransparency = ESP_SETTINGS.BOX_TRANSPARENCY
        leftLine.Parent = boxGui
        
        -- Linha direita
        local rightLine = Instance.new("Frame")
        rightLine.Name = "RightLine"
        rightLine.Size = UDim2.new(0, ESP_SETTINGS.BOX_THICKNESS, 1, 0)
        rightLine.Position = UDim2.new(1, -ESP_SETTINGS.BOX_THICKNESS, 0, 0)
        rightLine.BackgroundColor3 = ESP_SETTINGS.BOX_COLOR_ENEMY
        rightLine.BorderSizePixel = 0
        rightLine.BackgroundTransparency = ESP_SETTINGS.BOX_TRANSPARENCY
        rightLine.Parent = boxGui
        
        boxGui.Parent = CoreGui
        espObjects[player].boxGui = boxGui
    end
    
    -- Criar Label do Nome
    if ESP_SETTINGS.SHOW_NAME then
        local nameLabel = Instance.new("BillboardGui")
        local textLabel = Instance.new("TextLabel")
        
        nameLabel.Name = "ESPName"
        nameLabel.Adornee = humanoidRootPart
        nameLabel.AlwaysOnTop = true
        nameLabel.Size = UDim2.new(0, 200, 0, 50)
        nameLabel.StudsOffset = Vector3.new(0, 4, 0) -- Acima da box
        
        textLabel.Size = UDim2.new(1, 0, 1, 0)
        textLabel.BackgroundTransparency = 1
        textLabel.Text = player.Name
        textLabel.TextColor3 = ESP_SETTINGS.TEXT_COLOR
        textLabel.TextSize = ESP_SETTINGS.TEXT_SIZE
        textLabel.TextStrokeTransparency = 0
        textLabel.Font = ESP_SETTINGS.TEXT_FONT
        textLabel.Parent = nameLabel
        
        nameLabel.Parent = CoreGui
        espObjects[player].nameLabel = nameLabel
    end
    
    -- Criar Label de Distância
    if ESP_SETTINGS.SHOW_DISTANCE then
        local distanceLabel = Instance.new("BillboardGui")
        local textLabel = Instance.new("TextLabel")
        
        distanceLabel.Name = "ESPDistance"
        distanceLabel.Adornee = humanoidRootPart
        distanceLabel.AlwaysOnTop = true
        distanceLabel.Size = UDim2.new(0, 200, 0, 50)
        distanceLabel.StudsOffset = Vector3.new(0, 2.5, 0) -- Entre a box e o nome
        
        textLabel.Size = UDim2.new(1, 0, 1, 0)
        textLabel.BackgroundTransparency = 1
        textLabel.TextColor3 = ESP_SETTINGS.TEXT_COLOR
        textLabel.TextSize = ESP_SETTINGS.TEXT_SIZE - 2
        textLabel.TextStrokeTransparency = 0
        textLabel.Font = ESP_SETTINGS.TEXT_FONT
        textLabel.Parent = distanceLabel
        
        distanceLabel.Parent = CoreGui
        espObjects[player].distanceLabel = distanceLabel
    end
end

-- Função para remover ESP
local function removeESP(player)
    if espObjects[player] then
        if espObjects[player].boxGui then
            espObjects[player].boxGui:Destroy()
        end
        if espObjects[player].nameLabel then
            espObjects[player].nameLabel:Destroy()
        end
        if espObjects[player].distanceLabel then
            espObjects[player].distanceLabel:Destroy()
        end
        espObjects[player] = nil
    end
end

-- Função para atualizar ESP
local function updateESP()
    for player, espData in pairs(espObjects) do
        if player and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local character = player.Character
            local humanoidRootPart = character.HumanoidRootPart
            local distance = getDistance(humanoidRootPart.Position)
            
            -- Verificar distância máxima
            if distance > ESP_SETTINGS.MAX_DISTANCE then
                if espData.boxGui then espData.boxGui.Enabled = false end
                if espData.nameLabel then espData.nameLabel.Enabled = false end
                if espData.distanceLabel then espData.distanceLabel.Enabled = false end
                continue
            end
            
            -- Atualizar cores baseado no time
            local isEnemyPlayer = isEnemy(player)
            local boxColor = isEnemyPlayer and ESP_SETTINGS.BOX_COLOR_ENEMY or ESP_SETTINGS.BOX_COLOR_TEAM
            
            -- Atualizar Box UI
            if espData.boxGui then
                espData.boxGui.Enabled = ESP_SETTINGS.SHOW_BOX and ESP_SETTINGS.ENABLED
                
                -- Atualizar cor de todas as linhas da box
                for _, line in ipairs(espData.boxGui:GetChildren()) do
                    if line:IsA("Frame") then
                        line.BackgroundColor3 = boxColor
                    end
                end
            end
            
            -- Atualizar Nome
            if espData.nameLabel then
                espData.nameLabel.Enabled = ESP_SETTINGS.SHOW_NAME and ESP_SETTINGS.ENABLED
                local textLabel = espData.nameLabel:FindFirstChildWhichIsA("TextLabel")
                if textLabel then
                    textLabel.TextColor3 = boxColor
                end
            end
            
            -- Atualizar Distância
            if espData.distanceLabel then
                espData.distanceLabel.Enabled = ESP_SETTINGS.SHOW_DISTANCE and ESP_SETTINGS.ENABLED
                local textLabel = espData.distanceLabel:FindFirstChildWhichIsA("TextLabel")
                if textLabel then
                    textLabel.Text = tostring(distance) .. " studs"
                    textLabel.TextColor3 = boxColor
                end
            end
            
        else
            -- Esconder se não tiver character
            if espData.boxGui then espData.boxGui.Enabled = false end
            if espData.nameLabel then espData.nameLabel.Enabled = false end
            if espData.distanceLabel then espData.distanceLabel.Enabled = false end
        end
    end
end

-- Gerenciar players
local function onPlayerAdded(player)
    if player == localPlayer then return end
    
    player.CharacterAdded:Connect(function()
        wait(1) -- Aguardar character carregar completamente
        createESP(player)
    end)
    
    player.CharacterRemoving:Connect(function()
        removeESP(player)
    end)
    
    if player.Character then
        createESP(player)
    end
end

local function onPlayerRemoving(player)
    removeESP(player)
end

-- Inicializar para players existentes
for _, player in ipairs(Players:GetPlayers()) do
    if player ~= localPlayer then
        onPlayerAdded(player)
    end
end

Players.PlayerAdded:Connect(onPlayerAdded)
Players.PlayerRemoving:Connect(onPlayerRemoving)

-- Loop de atualização
RunService.RenderStepped:Connect(updateESP)

-- Interface de usuário para controles
local function createControlGUI()
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "ESPControls"
    screenGui.Parent = CoreGui
    
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0, 200, 0, 150)
    frame.Position = UDim2.new(0, 10, 0, 10)
    frame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    frame.BackgroundTransparency = 0.3
    frame.BorderSizePixel = 0
    frame.Parent = screenGui
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = frame
    
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, 0, 0, 30)
    title.Position = UDim2.new(0, 0, 0, 0)
    title.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    title.Text = "ESP Controls"
    title.TextColor3 = Color3.fromRGB(255, 255, 255)
    title.TextSize = 16
    title.Font = Enum.Font.GothamBold
    title.Parent = frame
    
    local toggleButton = Instance.new("TextButton")
    toggleButton.Size = UDim2.new(0.8, 0, 0, 30)
    toggleButton.Position = UDim2.new(0.1, 0, 0, 40)
    toggleButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    toggleButton.Text = "ESP: ON"
    toggleButton.TextColor3 = Color3.fromRGB(0, 255, 0)
    toggleButton.TextSize = 14
    toggleButton.Font = Enum.Font.Gotham
    toggleButton.Parent = frame
    
    toggleButton.MouseButton1Click:Connect(function()
        ESP_SETTINGS.ENABLED = not ESP_SETTINGS.ENABLED
        toggleButton.Text = ESP_SETTINGS.ENABLED and "ESP: ON" or "ESP: OFF"
        toggleButton.TextColor3 = ESP_SETTINGS.ENABLED and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(255, 0, 0)
    end)
    
    local teamCheckButton = Instance.new("TextButton")
    teamCheckButton.Size = UDim2.new(0.8, 0, 0, 30)
    teamCheckButton.Position = UDim2.new(0.1, 0, 0, 80)
    teamCheckButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    teamCheckButton.Text = "Team Check: ON"
    teamCheckButton.TextColor3 = Color3.fromRGB(0, 255, 0)
    teamCheckButton.TextSize = 14
    teamCheckButton.Font = Enum.Font.Gotham
    teamCheckButton.Parent = frame
    
    teamCheckButton.MouseButton1Click:Connect(function()
        ESP_SETTINGS.TEAM_CHECK = not ESP_SETTINGS.TEAM_CHECK
        teamCheckButton.Text = ESP_SETTINGS.TEAM_CHECK and "Team Check: ON" or "Team Check: OFF"
        teamCheckButton.TextColor3 = ESP_SETTINGS.TEAM_CHECK and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(255, 0, 0)
    end)
end

-- Criar GUI de controles
createControlGUI()

print("Universal ESP UI carregado! Use a interface no canto superior esquerdo para controlar o ESP.")
